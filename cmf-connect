#!/bin/bash

MAC="XX:XX:XX:XX:XX:XX"
DEVICE_NAME="DEVICE_NAME"

echo "üéß Forcing connection to $DEVICE_NAME..."

# 1. Disconnect first to clear any ghost connections
bluetoothctl disconnect $MAC > /dev/null 2>&1
sleep 1

# 2. Trust and Connect to the specific audio MAC
bluetoothctl trust $MAC > /dev/null 2>&1
echo "Connecting to $MAC..."
bluetoothctl connect $MAC

# 3. Wait a moment for the audio server (PipeWire/PulseAudio) to wake up
sleep 2

# 4. Find the Bluetooth sound card and force High-Fidelity Audio (A2DP)
CARD=$(pactl list cards short | grep -i "bluez_card" | awk '{print $2}')

if [ -n "$CARD" ]; then
    echo "üéµ Forcing A2DP audio profile on $CARD..."
    pactl set-card-profile "$CARD" a2dp-sink > /dev/null 2>&1
    echo "‚úÖ Success! Your earbuds/headphones should be playing audio now."
else
    echo "‚ö†Ô∏è Connected to Bluetooth, but couldn't detect the audio card. You may need to select them in Sound Settings."
fi
